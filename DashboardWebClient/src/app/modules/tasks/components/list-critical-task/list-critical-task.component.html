<div class="mt-5 shadow">
  <div class="d-inline-flex table-title col-12 border border-secondary-subtle border-bottom-0 border-1 p-3 mb-0 rounded-top text-center">
    <app-create-critical-task></app-create-critical-task>
    <h3 class="mx-auto mt-1"><i class="bi bi-exclamation-triangle me-2" style="color:red"></i>Критичные и блокирующие проблемы</h3>
  </div>
  <div class="table-responsive text-center" style="max-height: 600px; position: relative">
    <app-loader [loading]="isLoading"></app-loader>
    <table class="table table-light table-bordered table-hover mb-0" style="max-height: 600px">
      <thead>
        <tr>
          <th>
            Номер
          </th>
          <th>
            Статус в itsm
          </th>
          <th>
            Статуc в redmine
          </th>
          <th>
            Описание
          </th>
          <th>
            Дата регистрации
          </th>
          <th>
            Крайний срок
          </th>
          <th>
            Статус проблемы
          </th>
          <th>
            Открыть в RM
          </th>
        </tr>
      </thead>
      <tbody *ngFor="let data of taskData; let i=index" (click)="showContextMenu($event, i)" style="cursor: pointer">
        <tr>
          <td>
            {{ data.taskNumber }}
          </td>
          <td class="text-center">
            {{ data.itsmStatus }}
          </td>
          <td class="text-center">
            {{ data.redmineSatus }}
          </td>
          <td class="critical-task-description">
            {{ data.description }}
          </td>
          <td class="text-center">
            {{ data.startDate | date : "dd/MM/yy"}}
          </td>
          <td class="text-center">
            {{ data.endDate | date : "dd/MM/yy"}}
          </td>
          <td class="text-center">
            {{ data.actionStatus }}
          </td>
          <td class="target-link">
            <a href="{{ data.urlToRedmineTask }}" target="_blank"><i class="bi bi-box-arrow-up-right h4"></i></a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div *ngIf="contextMenuVisible"
       class="context-menu"
       [style.left.px]="contextMenuPosition.x"
       [style.top.px]="contextMenuPosition.y">
    <button (click)="openEditModal(); $event.stopPropagation()">Редактировать</button>
  </div>
</div>

<app-edit-critical-task #editModal></app-edit-critical-task>
<app-error-modal #errorModal></app-error-modal>
